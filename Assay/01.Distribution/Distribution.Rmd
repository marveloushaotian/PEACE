---
title: "**Distribution**"
author: "Haotian Zheng"
date: "24/01/2022"
output: html_document
---
*This document is meant to analysis the output data of padloc, defensefinder and crisprcastyper.*

*Aim to:*

1. Find the distribution of defense system in the plasmid genomes.
2. Caculate the percentage of each taxa data.

```{r, setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggrepel)
library(ggplot2)
library(ggrepel)
library(gggenes)
library(gg.gap)
library(ggbreak)
library(ggthemes)
library(ggpubr)
library(gtools)
library(igraph)
library(RColorBrewer)
library(dplyr)
library(plyr)
library(reshape2)
library(pheatmap)
library(readxl)
library(tibble)
library(scales)
library(psych)
library(vegan)
library(tidyverse)
library(knitr)
library(mixtools)
do.write <- F
options(scipen = 200)
color_my10 <- c("#EBEBF3","#F4EEEE","#0B89CF","#A7647A","#B4A9BC","#90A3BD","#39639B","#DF9599","#AACFDD","#D8757B")
color_my41 <- c("#e63946","#457b9d","#a8dadc","#f4a261","#e76f51","#ff6b6b","#e5989b","#4ecdc4","#9bc1bc","#3d5a80","#cbf3f0","#d3bcc0","#bfc0c0","#b2967d","#9db4c0","#74546a","#84a59d","#bee3db","#f28482","#89b0ae","#4ecdc4","#fe5f55","#68d8d6","#ffd5c2","#77bfa3","#b8d8d8","#f694c1","#f7b267","#58a4b0","#f2cc8f","#a5668b","#f5cb5c","#06aed5","#ed6a5a","#5ca4a9","#ff715b","#59c3c3","#f4a261","#e63946","#fcb9b2","#8ac6d0")
color_heatmap_bule_red <- c("#7E1712","#bd2113","#e3460c","#f07701","#f59525","#fccbb8","#f5e13a","#a3e2e1","#6ab7e1","#4f74bb","#472497")  # top_soil:深红1，深红2，橙色1，橙色2，中黄，肉色，柠檬黄，浅蓝2，浅蓝1，深蓝2，深蓝1
color_4 <- c("#03a94d","#3846a2","#03b4c5","#eb2c3a") #绿色，深蓝，浅蓝，红色
color_2 <- c("#04adef","#f15b2b") #天蓝，橙色
color10 <- c('#8DD3C7', '#FFFFB3', '#BEBADA', '#FB8072', '#80B1D3', '#FDB462', '#B3DE69', '#FCCDE5', '#BC80BD', '#CCEBC5', 'gray')
```

### Import combined and filtered origin data.
```{r}
# combined_data <- read.delim("../Results/2.Combined_Data/final_combined2.txt",header = T, check.names = F)
defensefinder_padloc_combined_data <- read.delim("../../Results/00.Original_Data/04.combined_data/DefenseFinder_Padloc_Combine/Final_data.txt",header = T, check.names = F)
cctyper_data <- read.table("../../Results/00.Original_Data/03.cctyper_data/cctyper_combined_mar.txt",header = T,check.names = F)
metadata_plsdb <- read.delim("../../Results/00.Original_Data/00.meta_data/plsdb_metadata_mar.txt",header = T,sep = "\t")
cctyper_data2 <- left_join(cctyper_data[,c(-2)],metadata_plsdb)
cctyper_data3 <- cctyper_data2 %>% filter(cctyper_data2$Source != "CCTyper_Crispr")
combined_data <- rbind(defensefinder_padloc_combined_data,cctyper_data3)
# remove the stange plasmid.
combined_data2 <- combined_data %>% filter(combined_data$Plasmid_ID != "NZ_CP069303.1")
# write.table(combined_data2, "../Results/3.Preliminary_Analysis/all_combined_data.txt", sep = "\t", row.names = F)

argonaute_origin <- read.table("../../Results/00.Original_Data/10.argonaute_data/argonaute_origin_data.txt",header = T, check.names = F, sep = "\t")
argonaute_selected <- read.table("../../Results/00.Original_Data/10.argonaute_data/argonaute_selected_file.txt", header = T, check.names = F, sep = "\t")
combined_data2 <- read.table("../../Results/00.Original_Data/all_combined_data.txt", header = T, check.names = F, sep = "\t")

origin_metadata <- read_tsv("../../Results/00.Original_Data/00.meta_data/plsdb_filtered.tsv")
```

### Find the distribution of the denfence system in plasmids genome.
*How many defense system in each plasmid.*
```{r}
plasmid_dis <- tapply(combined_data2$Plasmid_ID, combined_data2$Plasmid_ID, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_ID")
plasmid_dis2 <- plasmid_dis %>% dplyr::rename(system_count = ".")
plasmid_dis2$system_count <- factor(plasmid_dis2$system_count, levels=unique(plasmid_dis2$system_count))

plasmid_dis3 <- tapply(plasmid_dis2$system_count, plasmid_dis2$system_count, length) %>% as.data.frame() %>% rownames_to_column("system_count")
plasmid_dis4 <- plasmid_dis3 %>% dplyr::rename(plasmid_count = ".")
plasmid_dis4[14,] <- c(0,(length(metadata_plsdb$Plasmid_ID)-length(plasmid_dis$Plasmid_ID)))
plasmid_dis4$system_count <- as.numeric(plasmid_dis4$system_count)

# plasmid_dis4$system_count <- ordered(c("0","1", "2", "3", "4", "5","6", "7", "8", "9", "10","11","12","13")) 
# plasmid_dis4$system_count <- factor(plasmid_dis4$system_count, levels=unique(plasmid_dis4$system_count))


# group_mean <- aggregate(length_data$Length, by = list(length_data$Num), mean) #I found that is wrong. dont need to count this thing.
# group_mean2 <- group_mean %>% rename(Number_of_defense_systems = Group.1, Length_of_genomes = x)
# group_mean2$Length_of_genomes <- ceiling(group_mean2$Length_of_genomes)
# group_mean2$Number_of_defense_systems <- as.character(group_mean2$Number_of_defense_systems)

# distri_data$Nb_genomes <- as.character(distri_data$Nb_genomes)
# distri_data$Nb_defense_systems <- as.character(distri_data$Nb_defense_systems)

ggplot(plasmid_dis4,aes(x=system_count,y=plasmid_count)) + 
  geom_bar(fill="steelblue",stat = 'identity',width = 0.8) + 
  geom_text(aes(label=plasmid_count),vjust = -0.2, hjust = 0.5,position = position_dodge2(width = 0.1, preserve = 'single')) + 
  scale_x_continuous(breaks = c(0:13)) + 
  scale_y_break(c(2050,29500),ticklabels = c(29500,30000),scales = 0.1) +
  labs(x="Nb plasmid defense systems", y="Nb plasmid genomes") + 
  theme_bw() + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )
if(do.write){
  ggsave(width=6,height=6,filename="../Results/3.Preliminary_Analysis/Distribution-of-defense-system-in-plasmid-genomes.pdf",limitsize = FALSE)
}
```

#### ARGONAUTE.
```{r}
plasmid_dis <- tapply(argonaute_selected$Plasmid_ID, argonaute_selected$Plasmid_ID, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_ID")
plasmid_dis2 <- plasmid_dis %>% dplyr::rename(system_count = ".")
plasmid_dis2$system_count <- factor(plasmid_dis2$system_count, levels=unique(plasmid_dis2$system_count))

plasmid_dis3 <- tapply(plasmid_dis2$system_count, plasmid_dis2$system_count, length) %>% as.data.frame() %>% rownames_to_column("system_count")
plasmid_dis4 <- plasmid_dis3 %>% dplyr::rename(plasmid_count = ".")
# plasmid_dis4[14,] <- c(0,(length(metadata_plsdb$Plasmid_ID)-length(plasmid_dis$Plasmid_ID)))
plasmid_dis4$system_count <- as.numeric(plasmid_dis4$system_count)

ggplot(plasmid_dis4,aes(x=system_count,y=plasmid_count)) + 
  geom_bar(fill="steelblue",stat = 'identity',width = 0.8) + 
  geom_text(aes(label=plasmid_count),vjust = -0.2, hjust = 0.5,position = position_dodge2(width = 0.1, preserve = 'single')) + 
  scale_x_continuous(breaks = c(0:13)) + 
  # scale_y_break(c(2050,29500),ticklabels = c(29500,30000),scales = 0.1) +
  labs(x="Nb plasmid defense systems", y="Nb plasmid genomes") + 
  theme_bw() + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )
if(do.write){
  ggsave(width=6,height=6,filename="../Results/3.Preliminary_Analysis/Distribution-of-defense-system-in-plasmid-genomes.pdf",limitsize = FALSE)
}
```
*so we found that: after the selection, there are 55 defense systems in all, and 53 of them , 1 of them...*


*Frequency of systems in plasmid genomes.*
*not too good.*

```{r}
combined_data3 <- combined_data2
combined_data3$Plasmid_ID <- as.factor(combined_data3$Plasmid_ID)
combined_data3$Defense_System_Type <- as.factor(combined_data3$Defense_System_Type)
# freq_db <- tapply(combined_data3$Defense_System_Type, combined_data3$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
# This method is simple, but the result have redundancy, because one plasmid may have more than one defence system record.



combined_data4 = as.data.frame(matrix(nrow=50,ncol=2))

for (i in 1:length(levels(combined_data3$Defense_System_Type))) {
  system_type_name <- levels(droplevels(combined_data3$Defense_System_Type))[i]
  plasmid_selected_dataframe <- combined_data3 %>% filter(combined_data3$Defense_System_Type == system_type_name)
  combined_data4$System_type[i] <- system_type_name
  combined_data4$Occ_in_plasmids[i] <- length(levels(droplevels(plasmid_selected_dataframe$Plasmid_ID)))
}

combined_data5 <- combined_data4[,c(3,4)]
combined_data5$Frequency <- round(combined_data5$Occ_in_plasmids/length(unique(combined_data2$Plasmid_ID)),5)*100
combined_data5$Frequency_in_all_plasmid <- round(combined_data5$Occ_in_plasmids/length(unique(metadata_plsdb$Plasmid_ID)),5)*100

combined_data6 <- combined_data5[order(combined_data5$Frequency,decreasing = T),]
combined_data6$System_type <- factor(combined_data6$System_type, levels = unique(combined_data6$System_type))

combined_data7 <- melt(combined_data6,id.vars = c("System_type","Occ_in_plasmids"), variable.name = "Type", value.name = "Numbers")

ggplot(combined_data7,aes(x=System_type,y=Numbers,fill=Type)) + 
  geom_bar(stat = 'identity', position = "stack", width = 0.8) + 
  # geom_text(aes(label=Frequency),vjust = -0.2, hjust = 0.5,position = position_dodge2(width = 0.1, preserve = 'single')) + 
  labs(x="Defence system types", y="% of genomes encoding systems") + 
  theme_bw() + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 10, face = "bold", angle = 90, vjust = 0.5, hjust = 1),
        axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )
if(do.write){
  ggsave(width=12,height=5,filename="../Results/3.Preliminary_Analysis/frequence.pdf",limitsize = FALSE)
}
```

### The abundance of defense system in bacteria phylum. (pheatmap) *need to revise it.*
```{r}
# Get the absilute numbers of genomes encoding a given system.
plasmids_number <- combined_data2[,-c(3:18,20)] %>% filter(combined_data2$phylum != "")
plasmids_number2 <- tapply(plasmids_number$phylum, plasmids_number$phylum, length) %>% as.data.frame() %>% rownames_to_column("Phylum") # Count each plasmid have how many defense systems.
plasmids_number2 <- plasmids_number2 %>% dplyr::rename(system_count = ".")
plasmids_number2 <- plasmids_number2 %>% filter(plasmids_number2$system_count > 10)

plasmid_typer_df1 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[1])
heatmap_Actinobacteria <- tapply(plasmid_typer_df1$Defense_System_Type, plasmid_typer_df1$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Actinobacteria <- heatmap_Actinobacteria %>% dplyr::rename(Actinobacteria = ".")
plasmid_typer_df1_f <- unique(plasmid_typer_df1)
heatmap_Actinobacteria_f <- tapply(plasmid_typer_df1_f$Defense_System_Type, plasmid_typer_df1_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Actinobacteria_f <- heatmap_Actinobacteria_f %>% dplyr::rename(Actinobacteria = ".")
heatmap_Actinobacteria_f$Actinobacteria_Frequency <- round(heatmap_Actinobacteria_f$Actinobacteria/length(unique(plasmid_typer_df1$Plasmid_ID)),3)

plasmid_typer_df2 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[2])
heatmap_Bacteroidetes <- tapply(plasmid_typer_df2$Defense_System_Type, plasmid_typer_df2$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Bacteroidetes <- heatmap_Bacteroidetes %>% dplyr::rename(Bacteroidetes = ".")
plasmid_typer_df2_f <- unique(plasmid_typer_df2)
heatmap_Bacteroidetes_f <- tapply(plasmid_typer_df2_f$Defense_System_Type, plasmid_typer_df2_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Bacteroidetes_f <- heatmap_Bacteroidetes_f %>% dplyr::rename(Bacteroidetes = ".")
heatmap_Bacteroidetes_f$Bacteroidetes_Frequency <- round(heatmap_Bacteroidetes_f$Bacteroidetes/length(unique(plasmid_typer_df2$Plasmid_ID)),3)

plasmid_typer_df3 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[3])
heatmap_Cyanobacteria <- tapply(plasmid_typer_df3$Defense_System_Type, plasmid_typer_df3$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Cyanobacteria <- heatmap_Cyanobacteria %>% dplyr::rename(Cyanobacteria = ".")
plasmid_typer_df3_f <- unique(plasmid_typer_df3)
heatmap_Cyanobacteria_f <- tapply(plasmid_typer_df3_f$Defense_System_Type, plasmid_typer_df3_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Cyanobacteria_f <- heatmap_Cyanobacteria_f %>% dplyr::rename(Cyanobacteria = ".")
heatmap_Cyanobacteria_f$Cyanobacteria_Frequency <- round(heatmap_Cyanobacteria_f$Cyanobacteria/length(unique(plasmid_typer_df3$Plasmid_ID)),3)

plasmid_typer_df4 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[4])
heatmap_Deinococcus_Thermus <- tapply(plasmid_typer_df4$Defense_System_Type, plasmid_typer_df4$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Deinococcus_Thermus <- heatmap_Deinococcus_Thermus %>% dplyr::rename(Deinococcus_Thermus = ".")
plasmid_typer_df4_f <- unique(plasmid_typer_df4)
heatmap_Deinococcus_Thermus_f <- tapply(plasmid_typer_df4_f$Defense_System_Type, plasmid_typer_df4_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Deinococcus_Thermus_f <- heatmap_Deinococcus_Thermus_f %>% dplyr::rename(Deinococcus_Thermus = ".")
heatmap_Deinococcus_Thermus_f$Deinococcus_Thermus_Frequency <- round(heatmap_Deinococcus_Thermus_f$Deinococcus_Thermus/length(unique(plasmid_typer_df4$Plasmid_ID)),3)

plasmid_typer_df5 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[5])
heatmap_Firmicutes <- tapply(plasmid_typer_df5$Defense_System_Type, plasmid_typer_df5$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Firmicutes <- heatmap_Firmicutes %>% dplyr::rename(Firmicutes = ".")
plasmid_typer_df5_f <- unique(plasmid_typer_df5)
heatmap_Firmicutes_f <- tapply(plasmid_typer_df5_f$Defense_System_Type, plasmid_typer_df5_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Firmicutes_f <- heatmap_Firmicutes_f %>% dplyr::rename(Firmicutes = ".")
heatmap_Firmicutes_f$Firmicutes_Frequency <- round(heatmap_Firmicutes_f$Firmicutes/length(unique(plasmid_typer_df5$Plasmid_ID)),3)


plasmid_typer_df6 <- plasmids_number %>% filter(plasmids_number$phylum == plasmids_number2$Phylum[6])
heatmap_Proteobacteria <- tapply(plasmid_typer_df6$Defense_System_Type, plasmid_typer_df6$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Proteobacteria <- heatmap_Proteobacteria %>% dplyr::rename(Proteobacteria = ".")
plasmid_typer_df6_f <- unique(plasmid_typer_df6)
heatmap_Proteobacteria_f <- tapply(plasmid_typer_df6_f$Defense_System_Type, plasmid_typer_df6_f$Defense_System_Type, length) %>% as.data.frame() %>% rownames_to_column("System_name")
heatmap_Proteobacteria_f <- heatmap_Proteobacteria_f %>% dplyr::rename(Proteobacteria = ".")
heatmap_Proteobacteria_f$Proteobacteria_Frequency <- round(heatmap_Proteobacteria_f$Proteobacteria/length(unique(plasmid_typer_df6$Plasmid_ID)),3)

# all_joined_heatmapplot <- merge(heatmap_Proteobacteria,heatmap_Firmicutes,heatmap_Deinococcus_Thermus,heatmap_Cyanobacteria,heatmap_Bacteroidetes,heatmap_Actinobacteria)

data1 <- left_join(heatmap_Proteobacteria,heatmap_Firmicutes)
data2 <- left_join(data1,heatmap_Deinococcus_Thermus)
data3 <- left_join(data2,heatmap_Cyanobacteria)
data4 <- left_join(data3,heatmap_Bacteroidetes)
data5 <- left_join(data4,heatmap_Actinobacteria)
data5[is.na(data5)] <- 0
data5$Proteobacteria <- as.numeric(data5$Proteobacteria)
data6 <- data5 %>% column_to_rownames("System_name") %>% t() %>% as.data.frame()

data1_f <- left_join(heatmap_Proteobacteria_f,heatmap_Firmicutes_f)
data2_f <- left_join(data1_f,heatmap_Deinococcus_Thermus_f)
data3_f <- left_join(data2_f,heatmap_Cyanobacteria_f)
data4_f <- left_join(data3_f,heatmap_Bacteroidetes_f)
data5_f <- left_join(data4_f,heatmap_Actinobacteria_f)
data5_f[is.na(data5_f)] <- 0
data6_f <- data5_f[,c(1,3,5,7,9,11,13)] %>% column_to_rownames("System_name") %>% t() %>% as.data.frame()
row.names(data6_f) <- c("Proteobacteria","Firmicutes","Deinococcus_Thermus","Cyanobacteria","Bacteroidetes","Actinobacteria")
```

```{r}
# visualize.
# data7 <- decostand(data6,"standardize",MARGIN = 1)

data6_f2 <- as.matrix(data6_f)
data6_2 <- as.matrix(data6)

map <- pheatmap(data6_f2,
         cluster_rows = F, cluster_cols = F,
         color = colorRampPalette(c("#fdf2ef", "#e04320", "firebrick3"))(50),
         border=FALSE,
         display_numbers = data6_2, number_color = "black",
         cellwidth = 25, cellheight = 25
         )

save_pheatmap_pdf <- function(x, filename, width=20, height=6) {
   stopifnot(!missing(x))
   stopifnot(!missing(filename))
   pdf(filename, width=width, height=height)
   grid::grid.newpage()
   grid::grid.draw(x$gtable)
   dev.off()
}



save_pheatmap_pdf(map, "../Results/3.Preliminary_Analysis/pheatmap.pdf")

```






### The distribution of the defense system and plasmids genome with genome size.
### Plasmid Size - Plasmids number/Defence system number.
*how many plasmid have the same plasmid size range.*
*how many system have the same plasmid size range.*
*make the scales more details.*

### The composition of plasmids in bacteria env using own defensesystem database.
```{r}
Get_composition <- combined_data2[,-c(2:12)] %>% filter(combined_data2$phylum != "")
write.table(Get_composition,"../Results/3.Preliminary_Analysis/plasmid_composition.txt",row.names = F,sep = "\t")

Get_composition <- unique(Get_composition)
# Get_composition$phylum <- as.factor(Get_composition$phylum)
Get_composition$CountTag <- 1
Phylum_count_own <- aggregate(Get_composition$CountTag, by = list(as.factor(Get_composition$phylum)), sum)
Phylum_count_own2 <- Phylum_count_own %>% dplyr::rename(Bacteria = Group.1, Number = x)
Phylum_count_own3 <- Phylum_count_own2 %>% filter(Phylum_count_own2$Number > 2)
Phylum_count_own3_2 <- Phylum_count_own2 %>% filter(Phylum_count_own2$Number <= 2)
Phylum_count_own3$Bacteria <- as.character(Phylum_count_own3$Bacteria)
Phylum_count_own4 <- rbind(Phylum_count_own3,c("Others",sum(Phylum_count_own3_2$Number)))
Phylum_count_own4$Number <- as.numeric(Phylum_count_own4$Number)
Phylum_count_own4$percent <- percent(Phylum_count_own4$Number/sum(Phylum_count_own4$Number))
Phylum_count_own5 <- Phylum_count_own4 %>% filter(Phylum_count_own4$Bacteria != "Others")

Phylum_count_own5 <- Phylum_count_own5[order(Phylum_count_own5$Number,decreasing = T),]
Phylum_count_own5$Bacteria <- factor(Phylum_count_own5$Bacteria, levels = unique(Phylum_count_own5$Bacteria))
Phylum_count_own6 <- rbind(Phylum_count_own5,Phylum_count_own4[10,])

ggplot(Phylum_count_own6, aes(x=" ", y=Number, fill=Bacteria)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_manual(values=c(color10)) + 
  # theme_bw() + 
  # geom_text(aes(x=1,label=as.character(Phylum_count_own6$percent)),
            # position = position_stack(reverse =F,vjust=0.5),size=6) + 
  theme(plot.title = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.ticks = element_blank(),
        legend.title = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        panel.background = element_rect(I(0)),
        legend.position = 'right',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(0.8,'cm'),
        legend.spacing.y = unit(0.3,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )

if(do.write){
  ggsave(width=8,height=6,filename="../Results/3.Preliminary_Analysis/Plasmid_composition.pdf",limitsize = FALSE)
}

```

#### ARGONAUTE.
```{r}
Get_composition <- argonaute_selected[,-c(2:12)] %>% filter(argonaute_selected$phylum != "")
write.table(Get_composition,"../Results/3.Preliminary_Analysis/plasmid_composition.txt",row.names = F,sep = "\t")

Get_composition <- unique(Get_composition)
# Get_composition$phylum <- as.factor(Get_composition$phylum)
Get_composition$CountTag <- 1
Phylum_count_own <- aggregate(Get_composition$CountTag, by = list(as.factor(Get_composition$phylum)), sum)
Phylum_count_own2 <- Phylum_count_own %>% dplyr::rename(Bacteria = Group.1, Number = x)
Phylum_count_own3 <- Phylum_count_own2 %>% filter(Phylum_count_own2$Number > 2)
Phylum_count_own3_2 <- Phylum_count_own2 %>% filter(Phylum_count_own2$Number <= 2)
Phylum_count_own3$Bacteria <- as.character(Phylum_count_own3$Bacteria)
Phylum_count_own4 <- rbind(Phylum_count_own3,c("Others",sum(Phylum_count_own3_2$Number)))
Phylum_count_own4$Number <- as.numeric(Phylum_count_own4$Number)
Phylum_count_own4$percent <- percent(Phylum_count_own4$Number/sum(Phylum_count_own4$Number))
Phylum_count_own5 <- Phylum_count_own4 %>% filter(Phylum_count_own4$Bacteria != "Others")

Phylum_count_own5 <- Phylum_count_own5[order(Phylum_count_own5$Number,decreasing = T),]
Phylum_count_own5$Bacteria <- factor(Phylum_count_own5$Bacteria, levels = unique(Phylum_count_own5$Bacteria))
Phylum_count_own6 <- rbind(Phylum_count_own5,Phylum_count_own4[10,])

ggplot(Phylum_count_own6, aes(x=" ", y=Number, fill=Bacteria)) + 
  geom_bar(width = 1, stat = "identity") + 
  coord_polar("y", start=0) + 
  scale_fill_manual(values=c(color10)) + 
  # theme_bw() + 
  # geom_text(aes(x=1,label=as.character(Phylum_count_own6$percent)),
            # position = position_stack(reverse =F,vjust=0.5),size=6) + 
  theme(plot.title = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.ticks = element_blank(),
        legend.title = element_text(size = 12, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        panel.background = element_rect(I(0)),
        legend.position = 'right',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(0.8,'cm'),
        legend.spacing.y = unit(0.3,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )

if(do.write){
  ggsave(width=8,height=6,filename="../Results/3.Preliminary_Analysis/Plasmid_composition.pdf",limitsize = FALSE)
}
```




# The plasmid size and the plasmids number and defence systems number.
*a key question is need to divide all the records into different size.(plasmid size, so the tag should be done at the level of metadata.)*
*Distribution of the genome size.*
```{r}
plasmid_dis <- tapply(combined_data2$Plasmid_ID, combined_data2$Plasmid_ID, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_ID") # Count each plasmid have how many defense systems.
plasmid_dis2 <- plasmid_dis %>% dplyr::rename(system_count = ".")
plasmid_dis5 <- left_join(plasmid_dis2,metadata_plsdb[,c(1,3)]) # Add the plasmids length.

group_number <- ceiling(max(plasmid_dis5$Length)/50000) # 50kb as a group.
plasmid_dis5$Lengthtag <- c(1:length(plasmid_dis5$Plasmid_ID))

plasmid_dis6 <- list()
for (i in 1:group_number) {
  try({
    plasmid_dis6[[i]] <- plasmid_dis5 %>% filter(plasmid_dis5$Length >= ((i-1)*50000) & plasmid_dis5$Length < i*50000)
    plasmid_dis6[[i]]$Lengthtag <- i*50
    plasmid_dis6[[i]]$Lengthtagger <- paste0(i*50,"kb")
  })
}

plasmid_dis7 <- data.frame()
for (j in 1:(length(plasmid_dis6))) {
  if (j == 1) {
    plasmid_dis7 <- plasmid_dis6[[1]]
  } else if (j != 1) {
    plasmid_dis7 <- rbind(plasmid_dis7,plasmid_dis6[[j]])
  }
}


plasmid_dis7$Lengthtag <- as.factor(plasmid_dis7$Lengthtag)
plasmid_mean <- aggregate(plasmid_dis7$Length, by = list(plasmid_dis7$Lengthtag), mean)
plasmid_mean2 <- plasmid_mean %>% dplyr::rename(Plasmid_Size = Group.1, Length_of_genomes = x)
plasmid_dis8 <- tapply(plasmid_dis7$Lengthtag, plasmid_dis7$Lengthtag, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_Size")
plasmid_dis9 <- plasmid_dis8 %>% dplyr::rename(plasmid_count = ".")
plasmid_dis10 <- cbind(plasmid_mean2,plasmid_dis9$plasmid_count)
plasmid_dis11 <- plasmid_dis10 %>% dplyr::rename(Number_of_plasmid = "plasmid_dis9$plasmid_count")
plasmid_dis11$TAG <- plasmid_dis11$Plasmid_Size
# plasmid_dis11$Plasmid_Size <- as.numeric(plasmid_dis11$Plasmid_Size)



order_list <- plasmid_dis11$Plasmid_Size

plasmid_dis11$Plasmid_Size <- ordered(as.factor(mixedsort(as.numeric(order_list))))
plasmid_dis11$Plasmid_Size <- factor(plasmid_dis11$Plasmid_Size,levels = ordered(as.factor(mixedsort(as.numeric(order_list)))))

# The relation between the plasmid size and the how many numbers of plasmids in this.
# ggplot(plasmid_dis11,aes(x=TAG,y=Number_of_plasmid)) + 
#   geom_col(fill="steelblue",stat = 'identity',width = 0.8) + 
#   geom_text(aes(label=Number_of_plasmid),vjust = -0.2, hjust = 0.5,position = position_dodge2(width = 0.1, preserve = 'single')) + 
#   labs(x="Plasmids Size (Kb)", y="Nb plasmid genomes") + 
#   theme_bw() + 
#   theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
#         axis.title.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
#         axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
#         axis.text.x = element_text(size = 10, face = "bold", angle = 45, vjust = 1, hjust = 1),
#         axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
#         legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
#         legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
#         legend.key = element_rect(fill = 'transparent'),
#         legend.position = 'bottom',
#         legend.key.size=unit(0.8,'cm'),
#         legend.key.width=unit(1.2,'cm'),
#         legend.spacing.y = unit(0.5,"cm"),
#         # plot.margin = unit(c(1, 1, 1, 1),'cm'),
#         strip.text.y = element_text(size=15,face = "bold"),
#         strip.text.x = element_text(size=15,face = "bold")
#         )

#---------------
# all_median <- median(origin_metadata$Length_NUCCORE)
k <- normalmixEM2comp(log10(origin_metadata$Length_NUCCORE), sigsqrd = c(1,2), mu = c(3,5), lambda = 0.5)
parak <- 10^k$mu

line2.df <- data.frame(Group = c("all plasmids"),
                      LengthS = paste(round(c(parak[1],parak[2])/1000),"kbp"),
                      Length = c(parak[1],parak[2]),
                      Place = c(1,1))

#-------------
```

```{r}
# combined_data3 <- combined_data2 %>% filter(combined_data2$Defense_System_Type == "ARGONAUTE")
combined_data3 <- combined_data2
combined_data4 <- combined_data3[,c(1,11)] %>% unique()

# diff_data <- setdiff(origin_metadata$ACC_NUCCORE,combined_data4$Plasmid_ID)
# combined_data5 <- origin_metadata %>% filter(origin_metadata$ACC_NUCCORE %in% diff_data)
# combined_data6 <- combined_data5[,c(1,13)] %>% unique()

xx_median <- median(combined_data4$Length)
k <- normalmixEM2comp(log10(combined_data4$Length), sigsqrd = c(1,2), mu = c(3,5), lambda = 0.5)
parak <- 10^k$mu

ggplot(combined_data4,aes(x=Length)) + 
  geom_density() +
  labs(x="Plasmids Size (Kb)", y="Density") + 
  theme_bw() + 
  scale_x_log10(labels = COEF::fancy_scientific) + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_blank(),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.text.y = element_text(size = 13, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
)

if(do.write){
  ggsave(width=10,height=6,filename="../../Results/01.Distribution/plasmidsize_defense.pdf",limitsize = FALSE)
}
```

#### ARGONAUTE.
```{r}
plasmid_dis <- tapply(argonaute_selected$Plasmid_ID, argonaute_selected$Plasmid_ID, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_ID") # Count each plasmid have how many defense systems.
plasmid_dis2 <- plasmid_dis %>% dplyr::rename(system_count = ".")
plasmid_dis5 <- left_join(plasmid_dis2,metadata_plsdb[,c(1,3)]) # Add the plasmids length.

group_number <- ceiling(max(plasmid_dis5$Length)/50000) # 50kb as a group.
plasmid_dis5$Lengthtag <- c(1:length(plasmid_dis5$Plasmid_ID))

plasmid_dis6 <- list()
for (i in 1:group_number) {
  try({
    plasmid_dis6[[i]] <- plasmid_dis5 %>% filter(plasmid_dis5$Length >= ((i-1)*50000) & plasmid_dis5$Length < i*50000)
    plasmid_dis6[[i]]$Lengthtag <- i*50
    plasmid_dis6[[i]]$Lengthtagger <- paste0(i*50,"kb")
  })
}

plasmid_dis7 <- data.frame()
for (j in 1:(length(plasmid_dis6))) {
  if (j == 1) {
    plasmid_dis7 <- plasmid_dis6[[1]]
  } else if (j != 1) {
    plasmid_dis7 <- rbind(plasmid_dis7,plasmid_dis6[[j]])
  }
}


plasmid_dis7$Lengthtag <- as.factor(plasmid_dis7$Lengthtag)
plasmid_mean <- aggregate(plasmid_dis7$Length, by = list(plasmid_dis7$Lengthtag), mean)
plasmid_mean2 <- plasmid_mean %>% dplyr::rename(Plasmid_Size = Group.1, Length_of_genomes = x)
plasmid_dis8 <- tapply(plasmid_dis7$Lengthtag, plasmid_dis7$Lengthtag, length) %>% as.data.frame() %>% rownames_to_column("Plasmid_Size")
plasmid_dis9 <- plasmid_dis8 %>% dplyr::rename(plasmid_count = ".")
plasmid_dis10 <- cbind(plasmid_mean2,plasmid_dis9$plasmid_count)
plasmid_dis11 <- plasmid_dis10 %>% dplyr::rename(Number_of_plasmid = "plasmid_dis9$plasmid_count")
plasmid_dis11$TAG <- plasmid_dis11$Plasmid_Size
# plasmid_dis11$Plasmid_Size <- as.numeric(plasmid_dis11$Plasmid_Size)



order_list <- plasmid_dis11$Plasmid_Size

plasmid_dis11$Plasmid_Size <- ordered(as.factor(mixedsort(as.numeric(order_list))))
plasmid_dis11$Plasmid_Size <- factor(plasmid_dis11$Plasmid_Size,levels = ordered(as.factor(mixedsort(as.numeric(order_list)))))

# The relation between the plasmid size and the how many numbers of plasmids in this.
ggplot(plasmid_dis11,aes(x=TAG,y=Number_of_plasmid)) + 
  geom_col(fill="steelblue",stat = 'identity',width = 0.8) + 
  geom_text(aes(label=Number_of_plasmid),vjust = -0.2, hjust = 0.5,position = position_dodge2(width = 0.1, preserve = 'single')) + 
  labs(x="Plasmids Size (Kb)", y="Nb plasmid genomes") + 
  theme_bw() + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 10, face = "bold", angle = 45, vjust = 1, hjust = 1),
        axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )
if(do.write){
  ggsave(width=12,height=6,filename="../Results/3.Preliminary_Analysis/plasmidsize_plasmidnumbers.pdf",limitsize = FALSE)
}
```


*Average number od anti-phage system are correlated with genome size.(need to count the spearman.)*
```{r}
# The relation between the plasmid size and how many numbers of systems in this.
plasmid_dis12 <- aggregate(plasmid_dis7$system_count, by=list(plasmid_dis7$Lengthtag),mean)
plasmid_dis13 <- plasmid_dis12 %>% dplyr::rename(Plasmid_Size=Group.1,Number_of_systems=x)
plasmid_dis13$Number_of_systems <- round(plasmid_dis13$Number_of_systems,1)
# plasmid_dis13$tage <- plasmid_dis13$Plasmid_Size

# order_list <- plasmid_dis13$Plasmid_Size
# plasmid_dis13$Plasmid_Size <- ordered(as.factor(mixedsort(as.numeric(order_list))))
# plasmid_dis13$Plasmid_Size <- factor(plasmid_dis13$Plasmid_Size,levels = ordered(as.factor(mixedsort(as.numeric(order_list)))))

plasmid_dis13$Plasmid_Size <- as.numeric(plasmid_dis13$Plasmid_Size)
plasmid_dis13$tage <- plasmid_dis13$Plasmid_Size*50

ggplot(plasmid_dis13,aes(x=tage,y=Number_of_systems)) + 
  geom_point(fill="steelblue",stat = 'identity',width = 0.8) + 
  geom_smooth(method="loess") + 
  labs(x="Plasmids Size (Kb)", y="Nb defense systems") + 
  scale_x_continuous(breaks = seq(50,2900,100)) +
  theme_bw() + 
  theme(plot.title = element_text(size = 20, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.x = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        axis.title.y = element_text(size = 15, face = "bold", angle = 90, vjust = 0.5, hjust = 0.5),
        axis.text.x = element_text(size = 10, face = "bold", angle = 45, vjust = 0.5, hjust = 0.5),
        axis.text.y = element_text(size = 10, face = "bold", angle = 0, vjust = 0.5, hjust = 0.5),
        legend.title = element_text(size = 15, face = "bold", angle = 0, vjust = 0.5, hjust = 0),
        legend.text = element_text(size = 12, face = "plain", angle = 0, vjust = 0.5, hjust = 0),
        legend.key = element_rect(fill = 'transparent'),
        legend.position = 'bottom',
        legend.key.size=unit(0.8,'cm'),
        legend.key.width=unit(1.2,'cm'),
        legend.spacing.y = unit(0.5,"cm"),
        # plot.margin = unit(c(1, 1, 1, 1),'cm'),
        strip.text.y = element_text(size=15,face = "bold"),
        strip.text.x = element_text(size=15,face = "bold")
        )
if(do.write){
  ggsave(width=6,height=6,filename="../Results/3.Preliminary_Analysis/plasmidsize_systemnumber.pdf",limitsize = FALSE)
 }
```

#### ggGenes with argonaute.
```{r}
ggplot(example_genes, aes(xmin = start, xmax = end, y = molecule, fill = gene, label = gene)) + 
  geom_gene_arrow(arrowhead_height = unit(3, "mm"), arrowhead_width = unit(1, "mm")) + 
  geom_gene_label(align = "left") + 
  geom_blank(data = dummies) + 
  facet_wrap(~ molecule, scales = "free", ncol = 1) + 
  scale_fill_brewer(palette = "Set3") + 
  theme_genes()
```

```{r}
# get gggene data.
ar_data1 <- combined_data2 %>% filter(combined_data2$Plasmid_ID %in%  argonaute_selected$Plasmid_ID)
# ar_data1$Plasmid_ID <- as.factor(ar_data1$Plasmid_ID)
ar_data2 <- ar_data1[,c(1,2,4,5,8)]
ar_data2$Strand <- as.character(ar_data2$Strand)

# visualization.

# options(repr.plot.width = 20, repr.plot.height = 1000)
# dev.new(width=100, height=1000, unit="px")

ar_data2$System_Beg <- as.numeric(ar_data2$System_Beg)
ar_data2$System_End <- as.numeric(ar_data2$System_End)

dummies <- make_alignment_dummies(
  ar_data2,
  aes(xmin = System_Beg, xmax = System_End, y = Plasmid_ID, id = Defense_System_Type),
  on = "ARGONAUTE"
)

ar_data2 %>% 

# ar_data3 <- ar_data2 %>% filter(ar_data2$Plasmid_ID == "AP018320.1")

ggplot(ar_data3, aes(xmin = System_Beg, xmax = System_End, y = Plasmid_ID, fill = Defense_System_Type)) +
  geom_gene_arrow() +
  facet_wrap(~ Plasmid_ID, scales = "free", ncol = 1) +
  scale_fill_brewer(palette = "Set3")

if(do.write){
  ggsave(width=6,height=1,filename="../Results/3.Preliminary_Analysis/test.pdf",limitsize = FALSE)
}


# ggplot(ar_data3, aes(xmin = System_Beg, xmax = System_End, y = Plasmid_ID, fill = Defense_System_Type)) + 
#   geom_gene_arrow() +
#   geom_blank(data = dummies) +
#   facet_wrap(~ Plasmid_ID, scales = "free", ncol = 1) +
#   scale_fill_brewer(palette = color_my41) +
#   theme_genes()
```


```{r}
ggplot(example_genes, aes(xmin = start, xmax = end, y = molecule, fill = gene)) +
  geom_gene_arrow() +
  facet_wrap(~ molecule, scales = "free", ncol = 1) +
  scale_fill_brewer(palette = "Set3")
# ggsave("test.pdf", p, width = 10, height = 20)

geom_gene_arrow() +
ggplot2::geom_blank(data = dummies) +
ggplot2::facet_wrap(~ molecule, scales = "free", ncol = 1) +
ggplot2::scale_fill_brewer(palette = "Set3") +
theme_genes()


```


```{r}
geom_gene_arrow() +
  facet_wrap(~ Plasmid_ID, scales = "free", ncol = 1) +
  scale_fill_brewer(palette = "Set3")
```


# Fin.